# 2apifare é¡¹ç›®æ¶æ„å¯¹æ¯”åˆ†æ

> å¯¹æ¯”æ—¶é—´ï¼š2025-11-29
> æºé¡¹ç›®ï¼ˆsu-kakaï¼‰ï¼šhttps://github.com/su-kaka/gcli2api
> æˆ‘ä»¬çš„é¡¹ç›®ï¼šhttps://github.com/axibayuit-a11y/2apifare

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆå¯¹æ¯”

| ç»´åº¦ | su-kaka/gcli2api | æˆ‘ä»¬çš„ 2apifare |
|-----|-----------------|----------------|
| **æ ¸å¿ƒå®šä½** | GeminiCLI è½¬ API | GeminiCLI + Antigravity åŒåä»£ç³»ç»Ÿ |
| **æ”¯æŒçš„ API** | Gemini ç³»åˆ— | Gemini + Antigravity (Claude/GPT) |
| **è·¯ç”±å‰ç¼€** | æ— ç‰¹æ®Šå‰ç¼€ | `ANT/` å‰ç¼€è·¯ç”±åˆ° Antigravity |
| **å‡­è¯ç®¡ç†** | å•ä¸€ Gemini å‡­è¯ç³»ç»Ÿ | åŒå‡­è¯ç³»ç»Ÿï¼ˆGemini + Antigravityï¼‰ |
| **IP ç®¡ç†** | âŒ æ—  | âœ… å®Œæ•´ IP ç®¡ç†ç³»ç»Ÿ |
| **ç‹¼äººæ€åŠŸèƒ½** | âŒ æ—  | âœ… IP å°ç¦/é™é€Ÿæ¸¸æˆ |
| **è‡ªåŠ¨å¤‡ä»½** | âŒ æ—  | âœ… GitHub è‡ªåŠ¨å¤‡ä»½ |
| **æœ€åæ›´æ–°** | 2025-11-28 | 2025-11-27 |

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„å·®å¼‚

### 1. è·¯ç”±æ¶æ„

#### su-kaka é¡¹ç›®ï¼ˆå•ä¸€è·¯ç”±ï¼‰
```
/v1/chat/completions  â†’  Gemini API
/v1/models           â†’  Gemini æ¨¡å‹åˆ—è¡¨
```

#### æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆåŒè·¯ç”±ç³»ç»Ÿï¼‰
```
/v1/chat/completions
  â”œâ”€ å¸¸è§„æ¨¡å‹        â†’  Gemini API
  â””â”€ ANT/ å‰ç¼€æ¨¡å‹   â†’  Antigravity API

/v1/models           â†’  åˆå¹¶æ¨¡å‹åˆ—è¡¨ï¼ˆGemini + Antigravityï¼‰
```

**è·¯ç”±åˆ¤æ–­é€»è¾‘** ([openai_router.py:174-187](../src/openai_router.py#L174-L187)):
```python
# æ£€æµ‹æ˜¯å¦æ˜¯ Antigravity æ¨¡å‹ï¼ˆANT/ å‰ç¼€ï¼‰
if is_antigravity_model(model):
    log.info(f"Detected Antigravity model: {model}")
    ant_response = await handle_antigravity_request(request_data)

    # è®°å½•æˆåŠŸçš„IPè¯·æ±‚
    await ip_manager.record_request(
        ip=client_ip,
        endpoint="/v1/chat/completions",
        user_agent=user_agent,
        model=model
    )
    return ant_response

# GeminiCLI æ¨¡å‹å¤„ç†é€»è¾‘
use_fake_streaming = is_fake_streaming_model(model)
# ...
```

---

### 2. å‡­è¯ç®¡ç†ç³»ç»Ÿ

#### su-kaka é¡¹ç›®
```
src/credential_manager.py
  â””â”€ CredentialManager (å•ä¸€)
      â”œâ”€ Google OAuth å‡­è¯
      â”œâ”€ è½®æ¢æœºåˆ¶
      â””â”€ è‡ªåŠ¨ç¦ç”¨
```

#### æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆåŒç®¡ç†å™¨ï¼‰
```
src/credential_manager.py
  â””â”€ CredentialManager (Gemini)
      â”œâ”€ Google OAuth å‡­è¯
      â”œâ”€ è½®æ¢æœºåˆ¶
      â””â”€ è‡ªåŠ¨ç¦ç”¨

src/antigravity_credential_manager.py
  â””â”€ AntigravityCredentialManager
      â”œâ”€ accounts.toml å‡­è¯
      â”œâ”€ Token è‡ªåŠ¨åˆ·æ–°
      â”œâ”€ ç‹¬ç«‹è½®æ¢æœºåˆ¶
      â””â”€ é¡¹ç›®ä¿¡æ¯ç®¡ç†
```

**å…³é”®å·®å¼‚**ï¼š
- **å‡­è¯æ¥æºä¸åŒ**ï¼š
  - Gemini: Google OAuth JSON æ–‡ä»¶
  - Antigravity: accounts.toml (email/password)

- **Token æœºåˆ¶ä¸åŒ**ï¼š
  - Gemini: OAuth Token (é•¿æœŸæœ‰æ•ˆ)
  - Antigravity: éœ€å®šæœŸåˆ·æ–° Access Token

**Antigravity å‡­è¯ç»“æ„** ([antigravity_credential_manager.py:76-80](../src/antigravity_credential_manager.py#L76-L80)):
```python
async def _discover_credentials(self):
    """ä» accounts.toml åŠ è½½å‡­è¯"""
    accounts_data = await self._storage_adapter.load_antigravity_accounts()

    # accounts.toml æ ¼å¼ï¼š
    # [[accounts]]
    # email = "user@example.com"
    # password = "encrypted_password"
```

---

### 3. ä½¿ç”¨ç»Ÿè®¡ç³»ç»Ÿ

#### su-kaka é¡¹ç›®
```
src/usage_stats.py
  â””â”€ UsageStats (å•ä¸€)
      â”œâ”€ æŒ‰å‡­è¯ç»Ÿè®¡
      â”œâ”€ æŒ‰æ¨¡å‹ç»Ÿè®¡
      â””â”€ æ¯æ—¥é…é¢
```

#### æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆåŒç»Ÿè®¡ç³»ç»Ÿï¼‰
```
src/usage_stats.py
  â””â”€ UsageStats (Gemini)
      â”œâ”€ æŒ‰å‡­è¯ç»Ÿè®¡
      â”œâ”€ æŒ‰æ¨¡å‹ç»Ÿè®¡
      â””â”€ æ¯æ—¥é…é¢

src/antigravity_usage_stats.py
  â””â”€ AntigravityUsageStats
      â”œâ”€ æŒ‰è´¦æˆ·ç»Ÿè®¡
      â”œâ”€ æŒ‰ ANT/ æ¨¡å‹ç»Ÿè®¡
      â”œâ”€ Claude/GPT åˆ†å¼€ç»Ÿè®¡
      â””â”€ é”™è¯¯è¿½è¸ª
```

**Antigravity æ¨¡å‹ç»Ÿè®¡** ([antigravity_usage_stats.py:67-94](../src/antigravity_usage_stats.py#L67-L94)):
```python
def _is_claude_model(self, model_name: str) -> bool:
    """åˆ¤æ–­æ˜¯å¦æ˜¯ Claude æ¨¡å‹ (ANT/ å‰ç¼€)"""
    clean_model = model_name.replace("ANT/", "").lower()
    return any(name in clean_model for name in [
        "claude", "sonnet", "opus", "haiku"
    ])

def _is_gemini_model(self, model_name: str) -> bool:
    """åˆ¤æ–­æ˜¯å¦æ˜¯ Gemini æ¨¡å‹ (ANT/ å‰ç¼€)"""
    clean_model = model_name.replace("ANT/", "").lower()
    return "gemini" in clean_model
```

---

### 4. IP ç®¡ç†ç³»ç»Ÿï¼ˆæˆ‘ä»¬ç‹¬æœ‰ï¼‰

#### æ ¸å¿ƒåŠŸèƒ½ ([ip_manager.py](../src/ip_manager.py))

```python
class IPManager:
    """
    IP ç®¡ç†å™¨
    åŠŸèƒ½ï¼š
    1. è®°å½• IP è¯·æ±‚ç»Ÿè®¡ï¼ˆä»…æˆåŠŸçš„ AI å“åº”ï¼‰
    2. IP é»‘åå•/ç™½åå•ç®¡ç†
    3. IP é™é€ŸåŠŸèƒ½ï¼ˆæ¯åˆ†é’Ÿè¯·æ±‚æ¬¡æ•°ï¼‰
    4. IP åœ°ç†ä½ç½®æŸ¥è¯¢ï¼ˆä¸‰å±‚å…è´¹ API å¤‡ä»½ï¼‰
    5. 24å°æ—¶è‡ªåŠ¨è§£å°æœºåˆ¶
    """
```

**ç‰¹è‰²åŠŸèƒ½**ï¼š

1. **åœ°ç†ä½ç½®æŸ¥è¯¢**ï¼ˆä¸‰å±‚ API å¤‡ä»½ï¼‰:
   ```python
   # å…è´¹ API åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰
   1. ip-api.com
   2. ipapi.co
   3. ipwhois.app
   ```

2. **è‡ªåŠ¨è§£å°æœºåˆ¶**:
   ```python
   async def _periodic_unban_check(self):
       """å®šæœŸæ£€æŸ¥å¹¶è§£å° 24 å°æ—¶åçš„ IP"""
       while True:
           await asyncio.sleep(1800)  # æ¯ 30 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
           await self._check_and_unban_ips()
   ```

3. **ç‹¼äººæ€å¨±ä¹åŠŸèƒ½** ğŸº:
   - ç”¨æˆ·å¯äº’ç›¸å°ç¦/é™é€Ÿ IPï¼ˆæ— éœ€å¯†ç ï¼‰
   - å¢åŠ è¯·æ±‚æ¬¡æ•°éœ€è¦ç®¡ç†å‘˜å¯†ç éªŒè¯
   - å‰ç«¯å®æ—¶æ˜¾ç¤ºå°ç¦å€’è®¡æ—¶
   - âš ï¸ **ä»…ä¾›æµ‹è¯•å¨±ä¹ä½¿ç”¨**

**IP ç»Ÿè®¡è®°å½•æ—¶æœº**ï¼š
```python
# åªåœ¨æˆåŠŸå“åº”æ—¶è®°å½•ï¼ˆå¤±è´¥/é‡è¯•ä¸è®¡æ•°ï¼‰
await ip_manager.record_request(
    ip=client_ip,
    endpoint="/v1/chat/completions",
    user_agent=user_agent,
    model=model
)
```

---

### 5. å¤‡ä»½ç³»ç»Ÿï¼ˆæˆ‘ä»¬ç‹¬æœ‰ï¼‰

#### GitHub è‡ªåŠ¨å¤‡ä»½

**å®ç°ä½ç½®**: [src/backup_scheduler.py](../src/backup_scheduler.py)

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- âœ… å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶åˆ° GitHub
- âœ… è‡ªåŠ¨ commit å’Œ push
- âœ… å¤‡ä»½æ–‡ä»¶æ•°é‡é™åˆ¶ï¼ˆæœ€å¤š 20 ä¸ªï¼‰
- âœ… 3MB ä¸Šä¼ é™åˆ¶
- âœ… æ”¯æŒ Docker ç¯å¢ƒï¼ˆå·²å®‰è£… gitï¼‰

**å¤‡ä»½å†…å®¹**ï¼š
```
credentials/
  â”œâ”€ *.json          # Gemini å‡­è¯
  â”œâ”€ accounts.toml   # Antigravity å‡­è¯
  â”œâ”€ ip_stats.toml   # IP ç»Ÿè®¡
  â””â”€ config.toml     # é…ç½®æ–‡ä»¶
```

**æœ€è¿‘ä¿®å¤** (2025-11-27):
- âœ… ä¿®å¤ Git ç”¨æˆ·é…ç½®é—®é¢˜
- âœ… åœ¨ Docker é•œåƒä¸­å®‰è£… git
- âœ… ä¿®å¤ TOML æ ¼å¼é—®é¢˜
- âœ… æ‰¹é‡åˆ é™¤å´©æºƒé—®é¢˜

---

## ğŸ¯ su-kaka é¡¹ç›®çš„ä¼˜åŠ¿ï¼ˆæˆ‘ä»¬å¯ä»¥å€Ÿé‰´ï¼‰

### âœ… å·²åœ¨ gcli2api-ä¼˜åŒ–äº‹é¡¹åˆ†æ.md ä¸­è¯¦ç»†åˆ†æ

æ ¹æ® [gcli2api-ä¼˜åŒ–äº‹é¡¹åˆ†æ.md](./gcli2api-ä¼˜åŒ–äº‹é¡¹åˆ†æ.md)ï¼Œsu-kaka é¡¹ç›®çš„ 7 ä¸ªä¼˜åŒ–ç‚¹ï¼š

| ä¼˜å…ˆçº§ | ä¼˜åŒ–é¡¹ | æˆ‘ä»¬çš„çŠ¶æ€ | æ˜¯å¦å€Ÿé‰´ |
|-------|-------|----------|---------|
| ğŸ”´ P0 | Tool Calling Schema æ¸…ç† | âŒ ç¼ºå¤± | âœ… å¿…é¡» |
| ğŸ”´ P0 | å‡­è¯ç«‹å³ç”Ÿæ•ˆæœºåˆ¶ | âš ï¸ ä»ç”¨è½®è¯¢ | âœ… å¿…é¡» |
| ğŸŸ¡ P1 | è‡ªåŠ¨ç¦ç”¨ç²¾ç¡®æ€§æå‡ | âš ï¸ é€»è¾‘æ··æ‚ | âœ… å»ºè®® |
| ğŸŸ¡ P1 | æ€ç»´æ¨¡å¼è¿”å›å¯é€‰ | âŒ ç¼ºå¤± | âœ… å»ºè®® |
| ğŸŸ¢ P2 | Gemini-2.5-flash Bug | âš ï¸ éœ€æ£€æŸ¥ | âœ… å¯é€‰ |
| ğŸŸ¢ P2 | ä½¿ç”¨ç»Ÿè®¡ç²¾ç®€ | âœ… è¾ƒå¥½ | âš ï¸ å¯é€‰ |
| ğŸŸ¢ P2 | å–æ¶ˆä¸Šä¼ é™åˆ¶ | âŒ æœ‰é™åˆ¶ | âš ï¸ å¯é€‰ |

---

## ğŸš€ æˆ‘ä»¬çš„ç‹¬æœ‰ä¼˜åŠ¿

### 1. Antigravity é›†æˆ â­â­â­â­â­

**ä»·å€¼**ï¼š
- æ”¯æŒ Claude Sonnet 4.5ã€GPT-4 ç­‰æ¨¡å‹
- é€šè¿‡ `ANT/` å‰ç¼€æ— ç¼åˆ‡æ¢
- ç‹¬ç«‹å‡­è¯ç®¡ç†ï¼Œäº’ä¸å½±å“

**å®ç°æ¨¡å—**ï¼š
```
antigravity/
  â”œâ”€ api.py          # FastAPI è·¯ç”±
  â”œâ”€ auth.py         # OAuth è®¤è¯
  â”œâ”€ client.py       # API å®¢æˆ·ç«¯
  â”œâ”€ converter.py    # æ ¼å¼è½¬æ¢
  â””â”€ __init__.py

src/
  â”œâ”€ antigravity_credential_manager.py  # å‡­è¯ç®¡ç†
  â””â”€ antigravity_usage_stats.py         # ä½¿ç”¨ç»Ÿè®¡
```

**æ”¯æŒçš„æ¨¡å‹**ï¼ˆç¤ºä¾‹ï¼‰:
```
ANT/claude-sonnet-4-5
ANT/claude-sonnet-4-5-thinking
ANT/gemini-3-pro
ANT/gemini-3-pro-high
ANT/gemini-3-pro-low
ANT/gemini-3-pro-image
```

### 2. IP ç®¡ç†ç³»ç»Ÿ â­â­â­â­

**åº”ç”¨åœºæ™¯**ï¼š
- é˜²åˆ·æ¥å£ä¿æŠ¤
- ä½¿ç”¨é‡ç›‘æ§
- IP åœ°ç†åˆ†æ
- å¨±ä¹æµ‹è¯•ï¼ˆç‹¼äººæ€ï¼‰

**æ•°æ®ç»“æ„** (ip_stats.toml):
```toml
[ips."192.168.1.100"]
total_requests = 150
last_request = "2025-11-29T12:30:45+08:00"
location = "ä¸­å›½ å¹¿ä¸œ æ·±åœ³"
status = "active"  # active/banned/rate_limited
rate_limit = 60  # æ¯åˆ†é’Ÿè¯·æ±‚æ•°
banned_until = ""  # å°ç¦åˆ°æœŸæ—¶é—´
```

### 3. è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿ â­â­â­

**ä»·å€¼**ï¼š
- æ•°æ®å®‰å…¨ä¿éšœ
- ç‰ˆæœ¬æ§åˆ¶
- ç¾éš¾æ¢å¤
- å¤šç¯å¢ƒåŒæ­¥

### 4. æ—¶åŒºæœ¬åœ°åŒ– â­â­

**æ”¹è¿›** (2025-11-26):
```python
# ä¸œå…«åŒºæ—¶åŒº
UTC_PLUS_8 = timezone(timedelta(hours=8))

# ç»Ÿè®¡æ—¶é—´ä½¿ç”¨ä¸œå…«åŒº
timestamp = datetime.now(UTC_PLUS_8).isoformat()
```

**å½±å“**ï¼š
- IP ç»Ÿè®¡æ—¶é—´æ›´ç›´è§‚
- æ—¥å¿—æ—¶é—´æ›´å‡†ç¡®
- ç¬¦åˆå›½å†…ç”¨æˆ·ä¹ æƒ¯

---

## ğŸ” ä»£ç è´¨é‡å¯¹æ¯”

### æµ‹è¯•è¦†ç›–

| é¡¹ç›® | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç±»å‹ | CI/CD |
|-----|---------|---------|-------|
| su-kaka | âœ… å®Œæ•´ | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• | âœ… GitHub Actions |
| æˆ‘ä»¬ | âš ï¸ éƒ¨åˆ† | ä¸»è¦æ˜¯æ‰‹åŠ¨æµ‹è¯• | âœ… GitHub Actions (ç®€åŒ–) |

**æˆ‘ä»¬çš„æ”¹è¿›** (2025-11-26):
- âœ… ä¿®å¤ CI æµ‹è¯•å¤±è´¥é—®é¢˜
- âœ… é‡å‘½åæµ‹è¯•æ–‡ä»¶é¿å… pytest è‡ªåŠ¨æ”¶é›†
- âœ… å…è®¸æ²¡æœ‰æµ‹è¯•æ–‡ä»¶

### ä»£ç æ ¼å¼åŒ–

| é¡¹ç›® | æ ¼å¼åŒ–å·¥å…· | ä¸€è‡´æ€§ |
|-----|----------|-------|
| su-kaka | flake8 | âœ… ä¸¥æ ¼ |
| æˆ‘ä»¬ | Black | âœ… å·²åº”ç”¨ (2025-11-22) |

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”åˆ†æ

### å‡­è¯è½®æ¢æœºåˆ¶

#### su-kakaï¼ˆæ—§ç‰ˆ - è½®è¯¢æ¨¡å¼ï¼‰
```python
# åå°çº¿ç¨‹æ¯ 60 ç§’æ‰«æä¸€æ¬¡
async def _background_worker(self):
    while not self._shutdown_event.is_set():
        await asyncio.wait_for(self._shutdown_event.wait(), timeout=60.0)
        await self._discover_credentials()
```

**é—®é¢˜**ï¼š
- â±ï¸ æ–°å‡­è¯ç”Ÿæ•ˆå»¶è¿Ÿæœ€å¤š 60 ç§’
- ğŸ”’ å®šæœŸæ‰«æå¢åŠ é”ç«äº‰
- ğŸ’¾ åå°çº¿ç¨‹å ç”¨èµ„æº

#### su-kakaï¼ˆæ–°ç‰ˆ - äº‹ä»¶é©±åŠ¨ï¼‰âœ¨
```python
async def add_credential(self, credential_name: str, credential_data: Dict[str, Any]):
    """æ–°å¢å‡­è¯ï¼Œç«‹å³ç”Ÿæ•ˆ"""
    # 1. å†™å…¥å­˜å‚¨
    await self._storage_adapter.save_credential(credential_name, credential_data)

    # 2. ç«‹å³åŠ å…¥é˜Ÿåˆ—
    async with self._state_lock:
        if credential_name not in self._credential_files:
            self._credential_files.append(credential_name)
            log.info(f"å‡­è¯ {credential_name} å·²æ·»åŠ åˆ°è½®æ¢é˜Ÿåˆ—")
```

**ä¼˜åŠ¿**ï¼š
- âš¡ ç«‹å³ç”Ÿæ•ˆ
- ğŸ“‰ å‡å°‘ CPU å ç”¨
- ğŸ”“ å‡å°‘é”ç«äº‰

#### æˆ‘ä»¬çš„é¡¹ç›®ï¼ˆå½“å‰ä»ç”¨è½®è¯¢ï¼‰âš ï¸
```python
# ä»ç„¶ä½¿ç”¨åå°çº¿ç¨‹è½®è¯¢
async def _background_worker(self):
    while not self._shutdown_event.is_set():
        await asyncio.sleep(60)
        await self._discover_credentials()
```

**å»ºè®®**ï¼šğŸ”´ **ä¼˜å…ˆçº§ P0 - å¿…é¡»å‡çº§åˆ°äº‹ä»¶é©±åŠ¨æ¨¡å¼**

---

### IP ç®¡ç†æ€§èƒ½

**æˆ‘ä»¬çš„ä¼˜åŒ–** (å·²å®ç°):
```python
# å®šæœŸä¿å­˜ï¼ˆå‡å°‘ I/Oï¼‰
async def _periodic_save(self):
    while True:
        await asyncio.sleep(60)  # æ¯60ç§’ä¿å­˜ä¸€æ¬¡
        if self._cache_dirty:
            await self._save_ip_data()

# å®šæœŸè§£å°ï¼ˆå‡å°‘æ‰«æé¢‘ç‡ï¼‰
async def _periodic_unban_check(self):
    while True:
        await asyncio.sleep(1800)  # æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        await self._check_and_unban_ips()
```

**æ€§èƒ½ç‰¹ç‚¹**ï¼š
- âœ… å†…å­˜ç¼“å­˜å‡å°‘ç£ç›˜ I/O
- âœ… æ‰¹é‡ä¿å­˜æå‡æ•ˆç‡
- âœ… é™ä½æ‰«æé¢‘ç‡å‡å°‘ CPU å ç”¨

---

## ğŸ› ï¸ å€Ÿé‰´å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šå…³é”® Bug ä¿®å¤ï¼ˆ1-2 å¤©ï¼‰

#### 1. Tool Calling Schema æ¸…ç† ğŸ”´ P0
**æ–‡ä»¶**: [src/openai_transfer.py](../src/openai_transfer.py)

**æ”¹åŠ¨**ï¼š
```python
# æ–°å¢å‡½æ•°
def _clean_schema_for_gemini(schema: Any) -> Any:
    """æ¸…ç† Gemini ä¸æ”¯æŒçš„ JSON Schema å­—æ®µ"""
    # ... å®ç°è§ gcli2api-ä¼˜åŒ–äº‹é¡¹åˆ†æ.md

# åº”ç”¨åˆ°å·¥å…·è½¬æ¢
if "parameters" in function:
    cleaned_params = _clean_schema_for_gemini(function["parameters"])
    declaration["parameters"] = cleaned_params
```

**æµ‹è¯•**ï¼š
- âœ… Tool Calling è¯·æ±‚æˆåŠŸ
- âœ… è¿”å› finish_reason: "tool_calls"

---

### é˜¶æ®µäºŒï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ3-5 å¤©ï¼‰

#### 2. å‡­è¯ç«‹å³ç”Ÿæ•ˆæœºåˆ¶ ğŸ”´ P0

**æ¶‰åŠæ–‡ä»¶**ï¼š
- [src/credential_manager.py](../src/credential_manager.py)
- [src/antigravity_credential_manager.py](../src/antigravity_credential_manager.py)
- [src/web_routes.py](../src/web_routes.py)

**æ”¹åŠ¨èŒƒå›´**ï¼š
```python
# ç§»é™¤
- _background_worker() åå°çº¿ç¨‹
- _last_scan_time å®šæ—¶æ‰«æ
- _shutdown_event å…³é—­äº‹ä»¶

# æ–°å¢
+ add_credential() API
+ remove_credential() API
+ äº‹ä»¶é©±åŠ¨çš„é˜Ÿåˆ—æ›´æ–°
```

**æ”¶ç›Š**ï¼š
- âš¡ Gemini å‡­è¯ç«‹å³ç”Ÿæ•ˆ
- âš¡ Antigravity å‡­è¯ç«‹å³ç”Ÿæ•ˆ
- ğŸ“‰ å‡å°‘ç³»ç»Ÿèµ„æºå ç”¨

---

### é˜¶æ®µä¸‰ï¼šä»£ç è´¨é‡æå‡ï¼ˆ2-3 å¤©ï¼‰

#### 3. è‡ªåŠ¨ç¦ç”¨ç²¾ç¡®æ€§æå‡ ğŸŸ¡ P1

**æ–‡ä»¶**ï¼š
- [src/google_chat_api.py](../src/google_chat_api.py)
- [src/google_oauth_api.py](../src/google_oauth_api.py)

**æ”¹åŠ¨**ï¼š
```python
# æ‹†åˆ†å‡½æ•°
+ _check_should_auto_ban()
+ _handle_auto_ban()
+ _get_next_credential()
+ _handle_error_with_retry()
```

**æ”¶ç›Š**ï¼š
- âœ… ä»£ç å¯è¯»æ€§æå‡
- âœ… é€»è¾‘åˆ†ç¦»æ¸…æ™°
- âœ… æ›´å®¹æ˜“æµ‹è¯•

#### 4. æ€ç»´æ¨¡å¼è¿”å›å¯é€‰ ğŸŸ¡ P1

**æ–‡ä»¶**ï¼š
- [config.py](../config.py)
- [src/google_chat_api.py](../src/google_chat_api.py)
- [front/control_panel.html](../front/control_panel.html)

**æ”¹åŠ¨**ï¼š
```python
# é…ç½®é¡¹
+ get_return_thoughts_to_frontend()

# è¿‡æ»¤å‡½æ•°
+ _filter_thoughts_from_response()

# åº”ç”¨ä½ç½®ï¼ˆæµå¼/éæµå¼ï¼‰
if not return_thoughts:
    data = _filter_thoughts_from_response(data)
```

**æ”¶ç›Š**ï¼š
- ğŸ“‰ å‡å°‘å“åº”ä½“ç§¯
- âš¡ æå‡å“åº”é€Ÿåº¦
- ğŸ›ï¸ ç”¨æˆ·å¯æ§

---

### é˜¶æ®µå››ï¼šå¯é€‰ä¼˜åŒ–ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰

#### 5. Gemini-2.5-flash Bug ä¿®å¤ ğŸŸ¢ P2
#### 6. ä½¿ç”¨ç»Ÿè®¡ç²¾ç®€ ğŸŸ¢ P2
#### 7. å–æ¶ˆä¸Šä¼ é™åˆ¶ ğŸŸ¢ P2

---

## ğŸ“Š ç»¼åˆè¯„ä¼°

### æŠ€æœ¯æ ˆå¯¹æ¯”

| ç»„ä»¶ | su-kaka | æˆ‘ä»¬ | å·®å¼‚ |
|-----|---------|-----|------|
| Web æ¡†æ¶ | FastAPI | FastAPI | âœ… ç›¸åŒ |
| å¼‚æ­¥åº“ | asyncio | asyncio | âœ… ç›¸åŒ |
| HTTP å®¢æˆ·ç«¯ | httpx | httpx | âœ… ç›¸åŒ |
| é…ç½®ç®¡ç† | TOML | TOML | âœ… ç›¸åŒ |
| å­˜å‚¨é€‚é…å™¨ | ç»Ÿä¸€æ¥å£ | ç»Ÿä¸€æ¥å£ | âœ… ç›¸åŒ |
| è®¤è¯ç³»ç»Ÿ | Google OAuth | Google OAuth + Antigravity OAuth | â­ æˆ‘ä»¬æ›´ä¸°å¯Œ |
| å¤‡ä»½ç³»ç»Ÿ | âŒ æ—  | GitHub è‡ªåŠ¨å¤‡ä»½ | â­ æˆ‘ä»¬ç‹¬æœ‰ |
| IP ç®¡ç† | âŒ æ—  | å®Œæ•´ IP ç®¡ç† | â­ æˆ‘ä»¬ç‹¬æœ‰ |

### åŠŸèƒ½å®Œæ•´åº¦

| åŠŸèƒ½æ¨¡å— | su-kaka | æˆ‘ä»¬ | è¯„åˆ† |
|---------|---------|-----|------|
| Gemini API æ”¯æŒ | â­â­â­â­â­ | â­â­â­â­â­ | ç›¸åŒ |
| Tool Calling | â­â­â­â­â­ | â­â­â­â­ | su-kaka æ›´ç¨³å®š |
| æµå¼å“åº” | â­â­â­â­â­ | â­â­â­â­â­ | ç›¸åŒ |
| å‡­è¯ç®¡ç† | â­â­â­â­â­ | â­â­â­â­ | su-kaka æ›´ä¼˜åŒ– |
| Antigravity æ”¯æŒ | âŒ æ—  | â­â­â­â­â­ | æˆ‘ä»¬ç‹¬æœ‰ |
| IP ç®¡ç† | âŒ æ—  | â­â­â­â­â­ | æˆ‘ä»¬ç‹¬æœ‰ |
| è‡ªåŠ¨å¤‡ä»½ | âŒ æ—  | â­â­â­â­ | æˆ‘ä»¬ç‹¬æœ‰ |
| ä»£ç è´¨é‡ | â­â­â­â­â­ | â­â­â­â­ | su-kaka æ›´è§„èŒƒ |

### æ€§èƒ½è¯„ä¼°

| æŒ‡æ ‡ | su-kakaï¼ˆæ–°ç‰ˆï¼‰ | æˆ‘ä»¬ | å·®è· |
|-----|---------------|-----|------|
| å‡­è¯ç”Ÿæ•ˆæ—¶é—´ | ç«‹å³ | æœ€å¤š 60 ç§’ | ğŸ”´ éœ€ä¼˜åŒ– |
| è¯·æ±‚å“åº”æ—¶é—´ | å¿« | å¿« | âœ… ç›¸åŒ |
| å†…å­˜å ç”¨ | ä½ | ä¸­ç­‰ | âš ï¸ åŒç³»ç»Ÿå ç”¨æ›´å¤š |
| CPU å ç”¨ | ä½ | ä¸­ç­‰ | âš ï¸ åå°ä»»åŠ¡è¾ƒå¤š |
| å¹¶å‘èƒ½åŠ› | å¼º | å¼º | âœ… ç›¸åŒ |

---

## ğŸ¯ æ€»ç»“å’Œå»ºè®®

### æˆ‘ä»¬çš„ä¼˜åŠ¿ï¼ˆä¿æŒï¼‰âœ…
1. **Antigravity åŒåä»£ç³»ç»Ÿ** - æ ¸å¿ƒç«äº‰åŠ›
2. **IP ç®¡ç†ç³»ç»Ÿ** - ç‹¬ç‰¹åŠŸèƒ½
3. **è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿ** - æ•°æ®å®‰å…¨
4. **æ—¶åŒºæœ¬åœ°åŒ–** - ç”¨æˆ·ä½“éªŒ

### éœ€è¦å€Ÿé‰´çš„ä¼˜åŒ–ï¼ˆå®æ–½ï¼‰ğŸ“
1. **Tool Calling Schema æ¸…ç†** ğŸ”´ P0
2. **å‡­è¯ç«‹å³ç”Ÿæ•ˆæœºåˆ¶** ğŸ”´ P0
3. **è‡ªåŠ¨ç¦ç”¨ç²¾ç¡®æ€§æå‡** ğŸŸ¡ P1
4. **æ€ç»´æ¨¡å¼è¿”å›å¯é€‰** ğŸŸ¡ P1

### å®æ–½ä¼˜å…ˆçº§å»ºè®®

```
ç¬¬ä¸€å‘¨ï¼š
  Day 1-2: Tool Calling Schema æ¸…ç† âœ…
  Day 3-5: å‡­è¯ç«‹å³ç”Ÿæ•ˆï¼ˆGemini + Antigravityï¼‰âœ…

ç¬¬äºŒå‘¨ï¼š
  Day 1-2: è‡ªåŠ¨ç¦ç”¨é€»è¾‘é‡æ„ âœ…
  Day 3-4: æ€ç»´æ¨¡å¼è¿”å›å¯é€‰ âœ…
  Day 5: ä»£ç å®¡æŸ¥å’Œæµ‹è¯•

ç¬¬ä¸‰å‘¨ï¼š
  Day 1-3: å¯é€‰ä¼˜åŒ–ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰
  Day 4-5: æ–‡æ¡£æ›´æ–°å’Œå‘å¸ƒ
```

### æŠ€æœ¯å€ºåŠ¡æ¸…å•

1. **æµ‹è¯•è¦†ç›–ç‡ä¸è¶³** - å»ºè®®å¢åŠ å•å…ƒæµ‹è¯•
2. **åå°è½®è¯¢æœºåˆ¶** - ä¼˜å…ˆå‡çº§åˆ°äº‹ä»¶é©±åŠ¨
3. **é”™è¯¯å¤„ç†é€»è¾‘æ··æ‚** - éœ€è¦é‡æ„
4. **IP ç®¡ç†éšç§ä¿æŠ¤** - å·²å®ç°è„±æ•ï¼Œä½†å¯è¿›ä¸€æ­¥ä¼˜åŒ–

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [gcli2api ä¼˜åŒ–äº‹é¡¹åˆ†æ](./gcli2api-ä¼˜åŒ–äº‹é¡¹åˆ†æ.md)
- [su-kaka/gcli2api](https://github.com/su-kaka/gcli2api)
- [æˆ‘ä»¬çš„ä»“åº“](https://github.com/axibayuit-a11y/2apifare)
- [Antigravity æŠ€æœ¯æŠ¥å‘Š](./antigravity-tech-report.md)ï¼ˆå¦‚æœæœ‰ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025-11-29
**ç»´æŠ¤è€…**: Claude Code Analysis
**æ›´æ–°è®°å½•**:
- 2025-11-29: åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´æ¶æ„å¯¹æ¯”
